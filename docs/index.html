<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>doc-test</title><meta name="description" content="Documentation for doc-test"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">doc-test</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>doc-test</h2></div><div class="tsd-panel tsd-typography"><p><a href="https://classroom.github.com/a/7bX30zK4"><img src="https://classroom.github.com/assets/deadline-readme-button-24ddc0f5d75046c5622901739e7c5dd533143b0c8e959d652212380cedb1ea36.svg" alt="Review Assignment Due Date"></a></p>
<p><a href="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-gdiazbricio/actions/workflows/node.js.yml"><img src="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-gdiazbricio/actions/workflows/node.js.yml/badge.svg" alt="Tests"></a></p>
<p><a href="https://coveralls.io/github/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-gdiazbricio?branch=main"><img src="https://coveralls.io/repos/github/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-gdiazbricio/badge.svg?branch=main" alt="Coverage Status"></a></p>
<p><a href="https://sonarcloud.io/summary/new_code?id=ULL-ESIT-INF-DSI-2324_ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-gdiazbricio"><img src="https://sonarcloud.io/api/project_badges/measure?project=ULL-ESIT-INF-DSI-2324_ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-gdiazbricio&metric=alert_status" alt="Quality Gate Status"></a></p>
<a id="md:informe-httpsull-esit-inf-dsi-2324githubioull-esit-inf-dsi-23-24-prct11-http-express-magic-app-gdiazbricio" class="tsd-anchor"></a><h3><a href="#md:informe-httpsull-esit-inf-dsi-2324githubioull-esit-inf-dsi-23-24-prct11-http-express-magic-app-gdiazbricio">INFORME: <a href="https://ull-esit-inf-dsi-2324.github.io/ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-gdiazbricio/">https://ull-esit-inf-dsi-2324.github.io/ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-gdiazbricio/</a></a></h3><a id="md:práctica-11-diseño-de-una-aplicación-express-servidor-para-la-gestión-de-cartas-magic" class="tsd-anchor"></a><h1><a href="#md:práctica-11-diseño-de-una-aplicación-express-servidor-para-la-gestión-de-cartas-magic">PRÁCTICA 11: DISEÑO DE UNA APLICACIÓN EXPRESS SERVIDOR PARA LA GESTIÓN DE CARTAS MAGIC.</a></h1><a id="md:guillermo-díaz-bricio---desarrollo-de-sistemas-informáticos-3º-grado-en-ingeniería-informática" class="tsd-anchor"></a><h3><a href="#md:guillermo-díaz-bricio---desarrollo-de-sistemas-informáticos-3º-grado-en-ingeniería-informática">Guillermo Díaz Bricio - Desarrollo de Sistemas Informáticos, 3º Grado en Ingeniería Informática</a></h3><a id="md:contenidos" class="tsd-anchor"></a><h2><a href="#md:contenidos">Contenidos:</a></h2><ul>
<li><a href="#md:contenidos">Contenidos.</a></li>
<li><a href="#md:resumen">Resumen.</a></li>
<li><a href="#md:objetivos">Objetivos.</a></li>
<li><a href="#md:ejercicio-propuesto-en-el-guión">Ejercicio propuesto en el guión:</a></li>
<li><a href="#md:ejercicio-propuesto-en-el-aula">Ejercicio propuesto en el aula:</a></li>
<li><a href="#md:conclusiones">Conclusiones.</a></li>
<li><a href="#md:bibliografía">Bibliografía.</a></li>
</ul>
<a id="md:resumen" class="tsd-anchor"></a><h2><a href="#md:resumen">Resumen:</a></h2><p>En esta práctica se ha realizado una apliación multiusuario cliente servidor, permitiendo gestionar peticiones concurrentes para la gestión de colecciones de cartas Magic de diferentes usuarios. Cada usuario podrá realizar operaciones sobre su colección. Se deberá seguir trabajando con Objetos, Clases, Interfaces, gesitión del sistema de archivos,etcétera. Además de trabajar con la librería express que ofrece el framework express, la cual permite trabajar con puntos de acceso http.</p>
<a id="md:objetivos" class="tsd-anchor"></a><h2><a href="#md:objetivos">Objetivos:</a></h2><p>Los objetivos son:</p>
<ol>
<li>Manejar adecuadamente objetos.</li>
<li>Aplicar principios SOLID. </li>
<li>Diseño de un código consistente y bien formateado (mediante el uso de herramintas como ESLint y Prettier).</li>
<li>Desarrollo integrado mediante pruebas, utilizando Mocha y Chai.</li>
<li>Creación de documentación automátizada mediante TypeDoc.</li>
<li>Cubrimiento de código mediante c8 y coveralls.</li>
<li>Calidad de código por SonarCloud.</li>
<li>Trabajar con la librería express.</li>
</ol>
<a id="md:ejercicio-propuesto-en-el-guión" class="tsd-anchor"></a><h2><a href="#md:ejercicio-propuesto-en-el-guión">Ejercicio propuesto en el guión:</a></h2><p>En esta práctica se requería diseñar e implementar una aplicación express que permitiera a diferentes usuarios manejar su colección de cartas Magic, de manera que cada uno de ellos pueda realizar operaciones sobre la misma.</p>
<p>En primer lugar, se define la interfaz <code>Card</code>, que define la forma que debe tener un objeto de tipo carta Magic</p>
<pre><code class="language-typescript"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">Card</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">name</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">mana</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">color</span><span class="hl-1">: </span><span class="hl-3">Colors</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">typeLine</span><span class="hl-1">: </span><span class="hl-3">TypeLines</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">oddity</span><span class="hl-1">: </span><span class="hl-3">Oddities</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">rules</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">strength</span><span class="hl-1">?: </span><span class="hl-3">number</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">endurance</span><span class="hl-1">?: </span><span class="hl-3">number</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">loyalty</span><span class="hl-1">?: </span><span class="hl-3">number</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">marketValue</span><span class="hl-1">: </span><span class="hl-3">number</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Lo más importante a destacar son los campos opcionales, marcados con un <code>?</code> al lado de su identificador, nos permite definir campos que pueden estar presentes, o no.</p>
<p>Se definen también los siguientes enumerados:</p>
<ul>
<li>Colors: Define los colores que pueden tener las cartas.</li>
<li>TypeLines: Define los tipos que puede tener la carta.</li>
<li>Oddities: Define las diferentes rarezas que puede tener la carta.</li>
</ul>
<p>Una vez podamos definir cartas, es necesaria la implementación de una clase que almacene todas esas cartas, es aquí donde entra en juego la clase <code>CardCollection</code>:</p>
<pre><code class="language-typescript"><span class="hl-5">/**</span><br/><span class="hl-5"> * Represents a collection of cards.</span><br/><span class="hl-5"> */</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">CardCollection</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">/**</span><br/><span class="hl-5">   * The collection of cards.</span><br/><span class="hl-5">   */</span><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-4">collection</span><span class="hl-1">: </span><span class="hl-3">Card</span><span class="hl-1">[];</span><br/><br/><span class="hl-1">  </span><span class="hl-5">/**</span><br/><span class="hl-5">   * Creates an instance of CardCollection.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">user</span><span class="hl-5"> The user associated with the collection.</span><br/><span class="hl-5">   */</span><br/><span class="hl-1">  </span><span class="hl-2">constructor</span><span class="hl-1">(</span><span class="hl-2">private</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-4">collection</span><span class="hl-1"> = [];</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">/**</span><br/><span class="hl-5">   * Read a user&#39;s collection of cards.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">callback</span><span class="hl-5"> A function to be called when finishede.</span><br/><span class="hl-5">   */</span><br/><span class="hl-1">  </span><span class="hl-6">read</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-6">callback</span><span class="hl-1">: (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-3">void</span><span class="hl-1">,</span><br/><span class="hl-1">  ): </span><span class="hl-3">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">access</span><span class="hl-1">(</span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">, </span><span class="hl-4">constants</span><span class="hl-1">.</span><span class="hl-7">F_OK</span><span class="hl-1">, (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">callback</span><span class="hl-1">(</span><span class="hl-8">&quot;El usuario no existe&quot;</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">      } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">filesRead</span><span class="hl-1"> = </span><span class="hl-9">0</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-6">readdir</span><span class="hl-1">(</span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">, (</span><span class="hl-4">err</span><span class="hl-1">, </span><span class="hl-4">files</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">)</span><br/><span class="hl-1">            </span><span class="hl-6">callback</span><span class="hl-1">(</span><span class="hl-8">&quot;No se pudo leer la carpeta del usuario&quot;</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">files</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1">)</span><br/><span class="hl-1">              </span><span class="hl-6">callback</span><span class="hl-1">(</span><span class="hl-2">undefined</span><span class="hl-1">, </span><span class="hl-8">&quot;No hay ningun archivo que leer&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-4">files</span><span class="hl-1">.</span><span class="hl-6">forEach</span><span class="hl-1">((</span><span class="hl-4">file</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-6">readFile</span><span class="hl-1">(</span><span class="hl-8">`</span><span class="hl-2">${</span><span class="hl-2">this</span><span class="hl-10">.</span><span class="hl-4">user</span><span class="hl-2">}</span><span class="hl-8">/</span><span class="hl-2">${</span><span class="hl-4">file</span><span class="hl-2">}</span><span class="hl-8">`</span><span class="hl-1">, (</span><span class="hl-4">error</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-6">callback</span><span class="hl-1">(</span><span class="hl-8">`Error al leer archivo </span><span class="hl-2">${</span><span class="hl-4">file</span><span class="hl-2">}</span><span class="hl-8">`</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">                </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">                  </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-4">collection</span><span class="hl-1">.</span><span class="hl-6">push</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-6">parse</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">()));</span><br/><span class="hl-1">                  </span><span class="hl-4">filesRead</span><span class="hl-1">++;</span><br/><span class="hl-1">                  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">filesRead</span><span class="hl-1"> === </span><span class="hl-4">files</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">)</span><br/><span class="hl-1">                    </span><span class="hl-6">callback</span><span class="hl-1">(</span><span class="hl-2">undefined</span><span class="hl-1">, </span><span class="hl-8">&quot;Se ha añadido a la colección&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">              });</span><br/><span class="hl-1">            });</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">/**</span><br/><span class="hl-5">   * Gets the user associated with the collection.</span><br/><span class="hl-5">   * </span><span class="hl-2">@returns</span><span class="hl-5"> The user associated with the collection.</span><br/><span class="hl-5">   */</span><br/><span class="hl-1">  </span><span class="hl-6">getUser</span><span class="hl-1">(): </span><span class="hl-3">string</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>El constructor de la clase recibe un <code>user</code>, que será el usuario al que pertenece la colección, en el mismo constructor se inicializa un vector que contendrá la colección, que se actualizará cada vez que se llame al método <code>read</code>, que lee el directorio del usuario e itera sobre los archivos del mismo, insertando las cartas en la colección. Todos los accesos a los métodos para la gestión del sistema de archivos se realizan mediante la API asíncrona basada en callbacks de <code>net</code>. Podemos observar que dicho método se implementa también utilizando el patrón callback, que nos permitirá gestionar de una mejor manera los errores que puedan ocurrir durante la ejecución.</p>
<p>Se define el método <code>getUser</code> que devuelve el usuario al que pertenece la colección.</p>
<p>Por modularidad y cumplimiento del principio SOLID Open-Close se han declarado las diferentes operaciones que se pueden realizar sobre las colecciones en diferentes clases, todas han sido diseñadas siguiendo el patrón callback, por el mismo motivo que se mencionó anteriormente, además de que resultará más fácil a la hora de enviar la respuesta del servidor. Veremos en primer lugar la clase <code>AddCard</code>:</p>
<pre><code class="language-typescript"><span class="hl-5">/**</span><br/><span class="hl-5"> * Represents an operation to add a card to a collection.</span><br/><span class="hl-5"> */</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">AddCard</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">/**</span><br/><span class="hl-5">   * Creates an instance of AddCard.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">Cards</span><span class="hl-5"> The collection of cards to which the card will be added.</span><br/><span class="hl-5">   */</span><br/><span class="hl-1">  </span><span class="hl-2">constructor</span><span class="hl-1">(</span><span class="hl-2">private</span><span class="hl-1"> </span><span class="hl-4">Cards</span><span class="hl-1">: </span><span class="hl-3">CardCollection</span><span class="hl-1">) {}</span><br/><br/><span class="hl-1">  </span><span class="hl-5">/**</span><br/><span class="hl-5">   * Adds a new card to the collection.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">newCard</span><span class="hl-5"> The card to be added.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">callback</span><span class="hl-5"> A function to be called when finished.</span><br/><span class="hl-5">   */</span><br/><span class="hl-1">  </span><span class="hl-6">add</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">newCard</span><span class="hl-1">: </span><span class="hl-3">Card</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">callback</span><span class="hl-1">: (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-3">void</span><span class="hl-1">,</span><br/><span class="hl-1">  ): </span><span class="hl-3">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">urlPath</span><span class="hl-1"> = </span><span class="hl-8">`</span><span class="hl-2">${</span><span class="hl-2">this</span><span class="hl-10">.</span><span class="hl-4">Cards</span><span class="hl-10">.</span><span class="hl-6">getUser</span><span class="hl-10">()</span><span class="hl-2">}</span><span class="hl-8">/</span><span class="hl-2">${</span><span class="hl-4">newCard</span><span class="hl-10">.</span><span class="hl-4">name</span><span class="hl-2">}</span><span class="hl-8">.json`</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">toWrite</span><span class="hl-1"> = </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-6">stringify</span><span class="hl-1">(</span><span class="hl-4">newCard</span><span class="hl-1">, </span><span class="hl-2">null</span><span class="hl-1">, </span><span class="hl-9">2</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-6">access</span><span class="hl-1">(</span><span class="hl-4">urlPath</span><span class="hl-1">, (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">callback</span><span class="hl-1">(</span><span class="hl-8">&quot;La carta ya existe en la colección&quot;</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">      } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">writeFile</span><span class="hl-1">(</span><span class="hl-4">urlPath</span><span class="hl-1">, </span><span class="hl-4">toWrite</span><span class="hl-1">, { </span><span class="hl-4">flag:</span><span class="hl-1"> </span><span class="hl-8">&quot;w&quot;</span><span class="hl-1"> }, (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-6">callback</span><span class="hl-1">(</span><span class="hl-8">&quot;Error en el servidor&quot;</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-0">else</span><br/><span class="hl-1">            </span><span class="hl-6">callback</span><span class="hl-1">(</span><br/><span class="hl-1">              </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">              </span><span class="hl-8">`La carta se ha añadido a la colección de </span><span class="hl-2">${</span><span class="hl-2">this</span><span class="hl-10">.</span><span class="hl-4">Cards</span><span class="hl-10">.</span><span class="hl-6">getUser</span><span class="hl-10">()</span><span class="hl-2">}</span><span class="hl-8">`</span><span class="hl-1">,</span><br/><span class="hl-1">            );</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Se le pasará por constructor la colección sobre la que queremos hacer la operación, esto se repetirá en todas las clases de operaciones. Más adelante se define el método <code>add</code>, que primero compruba que la carta no esté ya en la colección, si no lo está la introduce.</p>
<p>También se define la clase <code>DeleteCard</code>:</p>
<pre><code class="language-typescript"><span class="hl-5">/**</span><br/><span class="hl-5"> * Represents an operation to delete a card from a collection.</span><br/><span class="hl-5"> */</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">DeleteCard</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">/**</span><br/><span class="hl-5">   * Creates an instance of DeleteCard.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">Cards</span><span class="hl-5"> The collection of cards from which the card will be deleted.</span><br/><span class="hl-5">   */</span><br/><span class="hl-1">  </span><span class="hl-2">constructor</span><span class="hl-1">(</span><span class="hl-2">private</span><span class="hl-1"> </span><span class="hl-4">Cards</span><span class="hl-1">: </span><span class="hl-3">CardCollection</span><span class="hl-1">) {}</span><br/><span class="hl-1">  </span><span class="hl-5">/**</span><br/><span class="hl-5">   * Deletes a card from the collection based on its id.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">toDeleteId</span><span class="hl-5"> The id of the card to be deleted.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">callback</span><span class="hl-5"> A function to be called when finished.</span><br/><span class="hl-5">   */</span><br/><span class="hl-1">  </span><span class="hl-6">delete</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">toDeleteId</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">callback</span><span class="hl-1">: (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-3">void</span><span class="hl-1">,</span><br/><span class="hl-1">  ): </span><span class="hl-3">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">found</span><span class="hl-1"> = </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-4">Cards</span><span class="hl-1">.</span><span class="hl-4">collection</span><span class="hl-1">.</span><span class="hl-6">find</span><span class="hl-1">((</span><span class="hl-4">card</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">card</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> === </span><span class="hl-4">toDeleteId</span><span class="hl-1">;</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">found</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">rm</span><span class="hl-1">(</span><span class="hl-8">`</span><span class="hl-2">${</span><span class="hl-2">this</span><span class="hl-10">.</span><span class="hl-4">Cards</span><span class="hl-10">.</span><span class="hl-6">getUser</span><span class="hl-10">()</span><span class="hl-2">}</span><span class="hl-8">/</span><span class="hl-2">${</span><span class="hl-4">found</span><span class="hl-10">.</span><span class="hl-4">name</span><span class="hl-2">}</span><span class="hl-8">.json`</span><span class="hl-1">, (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-6">callback</span><span class="hl-1">(</span><span class="hl-8">&quot;Error al eliminar&quot;</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">else</span><br/><span class="hl-1">          </span><span class="hl-6">callback</span><span class="hl-1">(</span><br/><span class="hl-1">            </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-8">`La carta </span><span class="hl-2">${</span><span class="hl-4">toDeleteId</span><span class="hl-2">}</span><span class="hl-8"> ha sido eliminada de la colección de </span><span class="hl-2">${</span><span class="hl-2">this</span><span class="hl-10">.</span><span class="hl-4">Cards</span><span class="hl-10">.</span><span class="hl-6">getUser</span><span class="hl-10">()</span><span class="hl-2">}</span><span class="hl-8">`</span><span class="hl-1">,</span><br/><span class="hl-1">          );</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-6">callback</span><span class="hl-1">(</span><span class="hl-8">&quot;La carta no fue encontrada&quot;</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>El método <code>delete</code> primero comprobará que la carta a eliminar existe, buscando su ID en la colección, si existe la elimina, si no existe emite un mensaje de error.</p>
<p>La clase <code>ListCards</code>:</p>
<pre><code class="language-typescript"><span class="hl-5">/**</span><br/><span class="hl-5"> * Represents an operation to list cards in a collection.</span><br/><span class="hl-5"> */</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">ListCards</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">/**</span><br/><span class="hl-5">   * Creates an instance of ListCards.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">Cards</span><span class="hl-5"> The collection of cards to be listed.</span><br/><span class="hl-5">   */</span><br/><span class="hl-1">  </span><span class="hl-2">constructor</span><span class="hl-1">(</span><span class="hl-2">private</span><span class="hl-1"> </span><span class="hl-4">Cards</span><span class="hl-1">: </span><span class="hl-3">CardCollection</span><span class="hl-1">) {}</span><br/><br/><span class="hl-1">  </span><span class="hl-5">/**</span><br/><span class="hl-5">   * Lists all the cards in the collection with their details.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">callback</span><span class="hl-5"> A function to be called when finished.</span><br/><span class="hl-5">   */</span><br/><span class="hl-1">  </span><span class="hl-6">list</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-6">callback</span><span class="hl-1">: (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-3">Card</span><span class="hl-1">[] | </span><span class="hl-3">undefined</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-3">void</span><span class="hl-1">,</span><br/><span class="hl-1">  ): </span><span class="hl-3">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-4">Cards</span><span class="hl-1">.</span><span class="hl-4">collection</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1">)</span><br/><span class="hl-1">      </span><span class="hl-6">callback</span><span class="hl-1">(</span><span class="hl-8">&quot;No hay cartas en la colección&quot;</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">callback</span><span class="hl-1">(</span><span class="hl-2">undefined</span><span class="hl-1">, </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-4">Cards</span><span class="hl-1">.</span><span class="hl-4">collection</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>El método <code>list</code> se encarga de comprobar que la lista no esté vacía, pondrá en el campo <code>data</code> de la función <code>callback</code> la colección.</p>
<p>La clase <code>ModifyCard</code>:</p>
<pre><code class="language-typescript"><span class="hl-5">/**</span><br/><span class="hl-5"> * Represents an operation to modify a card in a collection.</span><br/><span class="hl-5"> */</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">ModifyCard</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">/**</span><br/><span class="hl-5">   * Creates an instance of ModifyCard.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">Cards</span><span class="hl-5"> The collection of cards to be modified.</span><br/><span class="hl-5">   */</span><br/><span class="hl-1">  </span><span class="hl-2">constructor</span><span class="hl-1">(</span><span class="hl-2">private</span><span class="hl-1"> </span><span class="hl-4">Cards</span><span class="hl-1">: </span><span class="hl-3">CardCollection</span><span class="hl-1">) {}</span><br/><br/><span class="hl-1">  </span><span class="hl-5">/**</span><br/><span class="hl-5">   * Modifies a card in the collection.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">toModify</span><span class="hl-5"> The card to be modified.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">callback</span><span class="hl-5"> A function to be called when finished.</span><br/><span class="hl-5">   */</span><br/><span class="hl-1">  </span><span class="hl-6">modify</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">toModify</span><span class="hl-1">: </span><span class="hl-3">Card</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">callback</span><span class="hl-1">: (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-3">void</span><span class="hl-1">,</span><br/><span class="hl-1">  ): </span><span class="hl-3">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">found</span><span class="hl-1"> = </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-4">Cards</span><span class="hl-1">.</span><span class="hl-4">collection</span><span class="hl-1">.</span><span class="hl-6">find</span><span class="hl-1">((</span><span class="hl-4">card</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">card</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> === </span><span class="hl-4">toModify</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">;</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">found</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">urlPath</span><span class="hl-1"> = </span><span class="hl-8">`</span><span class="hl-2">${</span><span class="hl-2">this</span><span class="hl-10">.</span><span class="hl-4">Cards</span><span class="hl-10">.</span><span class="hl-6">getUser</span><span class="hl-10">()</span><span class="hl-2">}</span><span class="hl-8">/</span><span class="hl-2">${</span><span class="hl-4">found</span><span class="hl-10">.</span><span class="hl-4">name</span><span class="hl-2">}</span><span class="hl-8">.json`</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">toWrite</span><span class="hl-1"> = </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-6">stringify</span><span class="hl-1">(</span><span class="hl-4">toModify</span><span class="hl-1">, </span><span class="hl-2">null</span><span class="hl-1">, </span><span class="hl-9">2</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-6">writeFile</span><span class="hl-1">(</span><span class="hl-4">urlPath</span><span class="hl-1">, </span><span class="hl-4">toWrite</span><span class="hl-1">, { </span><span class="hl-4">flag:</span><span class="hl-1"> </span><span class="hl-8">&quot;w&quot;</span><span class="hl-1"> }, (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-6">callback</span><span class="hl-1">(</span><span class="hl-8">&quot;Error en el servidor&quot;</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">      });</span><br/><br/><span class="hl-1">      </span><span class="hl-6">rename</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-4">urlPath</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-8">`</span><span class="hl-2">${</span><span class="hl-2">this</span><span class="hl-10">.</span><span class="hl-4">Cards</span><span class="hl-10">.</span><span class="hl-6">getUser</span><span class="hl-10">()</span><span class="hl-2">}</span><span class="hl-8">/</span><span class="hl-2">${</span><span class="hl-4">toModify</span><span class="hl-10">.</span><span class="hl-4">name</span><span class="hl-2">}</span><span class="hl-8">.json`</span><span class="hl-1">,</span><br/><span class="hl-1">        (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-6">callback</span><span class="hl-1">(</span><span class="hl-8">&quot;Error en el servidor&quot;</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-0">else</span><br/><span class="hl-1">            </span><span class="hl-6">callback</span><span class="hl-1">(</span><br/><span class="hl-1">              </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">              </span><span class="hl-8">`La carta: </span><span class="hl-2">${</span><span class="hl-4">toModify</span><span class="hl-10">.</span><span class="hl-4">id</span><span class="hl-2">}</span><span class="hl-8"> ha sido modificada en la colección de </span><span class="hl-2">${</span><span class="hl-2">this</span><span class="hl-10">.</span><span class="hl-4">Cards</span><span class="hl-10">.</span><span class="hl-6">getUser</span><span class="hl-10">()</span><span class="hl-2">}</span><span class="hl-8">`</span><span class="hl-1">,</span><br/><span class="hl-1">            );</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">callback</span><span class="hl-1">(</span><span class="hl-8">&quot;La carta a modificar no fue encontrada&quot;</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Se accede a la carta a modificar, si se encuentra se modifica con la nueva información, en el caso de que se haya cambiado el nombre, también se cambia el nombre del fichero que la contiene, si no la encuentra, simplemente emite un mensaje de error.</p>
<p>La clase <code>ShowCard</code>, no nos centraremos en su implementación, pues es muy similar a la clase <code>ListCards</code>, pero simplemente sobre una carta.</p>
<p>En cuanto al código del lado del servidor, primero se crea una aplicación express, que se pone a escuchar en el puerto 60300, luego se incluyen las diferentes operaciones crud junto con su implementación.</p>
<pre><code class="language-typescript"><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1"> = </span><span class="hl-6">express</span><span class="hl-1">();</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">use</span><span class="hl-1">(</span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-6">json</span><span class="hl-1">());</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-8">&quot;/cards&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">) </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">({</span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-8">&quot;error&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-8">&quot;No se ha indicado usuario&quot;</span><span class="hl-1">});</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">user</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">myCollection</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">CardCollection</span><span class="hl-1">(</span><span class="hl-4">user</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">myCollection</span><span class="hl-1">.</span><span class="hl-6">read</span><span class="hl-1">((</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">( {</span><span class="hl-4">result:</span><span class="hl-1"> </span><span class="hl-8">&quot;error&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">err</span><span class="hl-1">} );</span><br/><span class="hl-1">      </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">myLister</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">ListCards</span><span class="hl-1">(</span><span class="hl-4">myCollection</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">myLister</span><span class="hl-1">.</span><span class="hl-6">list</span><span class="hl-1">((</span><span class="hl-4">err</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">result:</span><span class="hl-1"> </span><span class="hl-8">&quot;error&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">err</span><span class="hl-1"> });</span><br/><span class="hl-1">          </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">result:</span><span class="hl-1"> </span><span class="hl-8">&quot;success&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1"> });</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">myCollection</span><span class="hl-1">.</span><span class="hl-6">read</span><span class="hl-1">((</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">( { </span><span class="hl-4">result:</span><span class="hl-1"> </span><span class="hl-8">&quot;error&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">err</span><span class="hl-1">} );</span><br/><span class="hl-1">    </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">myReader</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">ShowCard</span><span class="hl-1">(</span><span class="hl-4">myCollection</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">myReader</span><span class="hl-1">.</span><span class="hl-6">showCard</span><span class="hl-1">(</span><span class="hl-6">Number</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">?.</span><span class="hl-6">toString</span><span class="hl-1">()), ((</span><span class="hl-4">err</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1"> ( {</span><span class="hl-4">result:</span><span class="hl-1"> </span><span class="hl-8">&quot;error&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">err</span><span class="hl-1">} );</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">result:</span><span class="hl-1"> </span><span class="hl-8">&quot;success&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">});</span><br/><span class="hl-1">      }));</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">post</span><span class="hl-1">(</span><span class="hl-8">&quot;/cards&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">) </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">({</span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-8">&quot;error&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-8">&quot;No se ha indicado usuario&quot;</span><span class="hl-1">});</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">user</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">myCollection</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">CardCollection</span><span class="hl-1">(</span><span class="hl-4">user</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">myCollection</span><span class="hl-1">.</span><span class="hl-6">read</span><span class="hl-1">((</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">( {</span><span class="hl-4">result:</span><span class="hl-1"> </span><span class="hl-8">&quot;error&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">err</span><span class="hl-1">} );</span><br/><span class="hl-1">      </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">myAdder</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">AddCard</span><span class="hl-1">(</span><span class="hl-4">myCollection</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">myAdder</span><span class="hl-1">.</span><span class="hl-6">add</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, (</span><span class="hl-4">err</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">result:</span><span class="hl-1"> </span><span class="hl-8">&quot;error&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">err</span><span class="hl-1"> });</span><br/><span class="hl-1">          </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">result:</span><span class="hl-1"> </span><span class="hl-8">&quot;success&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1"> });</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">delete</span><span class="hl-1">(</span><span class="hl-8">&quot;/cards&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">) </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">({</span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-8">&quot;error&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-8">&quot;No se ha indicado usuario&quot;</span><span class="hl-1">});</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">user</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">myCollection</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">CardCollection</span><span class="hl-1">(</span><span class="hl-4">user</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">myCollection</span><span class="hl-1">.</span><span class="hl-6">read</span><span class="hl-1">((</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">( {</span><span class="hl-4">result:</span><span class="hl-1"> </span><span class="hl-8">&quot;error&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">err</span><span class="hl-1">} );</span><br/><span class="hl-1">      </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">myRemover</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">DeleteCard</span><span class="hl-1">(</span><span class="hl-4">myCollection</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">myRemover</span><span class="hl-1">.</span><span class="hl-6">delete</span><span class="hl-1">(</span><span class="hl-6">Number</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">?.</span><span class="hl-6">toString</span><span class="hl-1">()), (</span><span class="hl-4">err</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">result:</span><span class="hl-1"> </span><span class="hl-8">&quot;error&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">err</span><span class="hl-1"> });</span><br/><span class="hl-1">          </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">result:</span><span class="hl-1"> </span><span class="hl-8">&quot;success&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1"> });</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">patch</span><span class="hl-1">(</span><span class="hl-8">&quot;/cards&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">) </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">({</span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-8">&quot;error&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-8">&quot;No se ha indicado usuario&quot;</span><span class="hl-1">});</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">user</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">myCollection</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">CardCollection</span><span class="hl-1">(</span><span class="hl-4">user</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">myCollection</span><span class="hl-1">.</span><span class="hl-6">read</span><span class="hl-1">((</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">( {</span><span class="hl-4">result:</span><span class="hl-1"> </span><span class="hl-8">&quot;error&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">err</span><span class="hl-1">} );</span><br/><span class="hl-1">      </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">myModifier</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">ModifyCard</span><span class="hl-1">(</span><span class="hl-4">myCollection</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">myModifier</span><span class="hl-1">.</span><span class="hl-6">modify</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, (</span><span class="hl-4">err</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">result:</span><span class="hl-1"> </span><span class="hl-8">&quot;error&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">err</span><span class="hl-1"> });</span><br/><span class="hl-1">          </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">result:</span><span class="hl-1"> </span><span class="hl-8">&quot;success&quot;</span><span class="hl-1">, </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1"> });</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">all</span><span class="hl-1">(</span><span class="hl-8">&quot;*&quot;</span><span class="hl-1">, (</span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-9">501</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-8">&quot;Operación no soportada&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">listen</span><span class="hl-1">(</span><span class="hl-9">60300</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-8">&quot;Server running on port 60300&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Además, se añade el método <code>all</code>, que junto con <code>*</code> gestiona las peticiones a operaciones que no están soportadas por la aplicación.</p>
<p>En este caso, no es necesario código cliente, pues son peticiones a la dirección http, aún así se ilustran algunas:</p>
<ul>
<li><code>http://localhost:60300/cards?user=Guille</code> junto con el método <code>GET</code>, devolverá todas las cartas del usuario Guille.</li>
<li><code>http://localhost:60300/cards?user=Guille</code> junto con <code>POST</code>, insertará la carta que se le pase en el cuerpo de la petición en la colección de Guille.</li>
<li><code>http://localhost:60300/cards?user=Guille&amp;id=3</code> usando el metodo <code>DELETE</code> eliminará la carta con <code>id=3</code>.</li>
<li><code>http://localhost:60300/cards?user=Guille</code> junto con <code>PATCH</code>, modificará la carta que se le pase en el cuerpo de la petición en la colección de Guille.</li>
</ul>
<a id="md:ejercicios-propuestos-en-el-aula" class="tsd-anchor"></a><h2><a href="#md:ejercicios-propuestos-en-el-aula">Ejercicios propuestos en el aula:</a></h2><p>Se solicitaba un cambio en dos de las operaciones implementadas, de manera que pasaran de usar el patron callback, a promesas, además de utilizar la API de filesystem de Node en su versión asíncrona basada en promesas. En este caso, se decidió modificar la operación <code>add</code> y <code>delete</code>:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-4">CardCollection</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-8">&quot;../CardCollection.js&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-4">Card</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-8">&quot;../Card.js&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-4">access</span><span class="hl-1">, </span><span class="hl-4">writeFile</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-8">&quot;node:fs/promises&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">/**</span><br/><span class="hl-5"> * Represents an operation to add a card to a collection.</span><br/><span class="hl-5"> */</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">AddCard</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">/**</span><br/><span class="hl-5">   * Creates an instance of AddCard.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">Cards</span><span class="hl-5"> The collection of cards to which the card will be added.</span><br/><span class="hl-5">   */</span><br/><span class="hl-1">  </span><span class="hl-2">constructor</span><span class="hl-1">(</span><span class="hl-2">private</span><span class="hl-1"> </span><span class="hl-4">Cards</span><span class="hl-1">: </span><span class="hl-3">CardCollection</span><span class="hl-1">) {}</span><br/><br/><span class="hl-1">  </span><span class="hl-5">/**</span><br/><span class="hl-5">   * Adds a new card to the collection.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">newCard</span><span class="hl-5"> The card to be added.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">callback</span><span class="hl-5"> A function to be called when finished.</span><br/><span class="hl-5">   */</span><br/><span class="hl-1">  </span><span class="hl-6">add</span><span class="hl-1">(</span><span class="hl-4">newCard</span><span class="hl-1">: </span><span class="hl-3">Card</span><span class="hl-1">): </span><span class="hl-3">Promise</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">urlPath</span><span class="hl-1"> = </span><span class="hl-8">`</span><span class="hl-2">${</span><span class="hl-2">this</span><span class="hl-10">.</span><span class="hl-4">Cards</span><span class="hl-10">.</span><span class="hl-6">getUser</span><span class="hl-10">()</span><span class="hl-2">}</span><span class="hl-8">/</span><span class="hl-2">${</span><span class="hl-4">newCard</span><span class="hl-10">.</span><span class="hl-4">name</span><span class="hl-2">}</span><span class="hl-8">.json`</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">toWrite</span><span class="hl-1"> = </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-6">stringify</span><span class="hl-1">(</span><span class="hl-4">newCard</span><span class="hl-1">, </span><span class="hl-2">null</span><span class="hl-1">, </span><span class="hl-9">2</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Promise</span><span class="hl-1">((</span><span class="hl-4">resolve</span><span class="hl-1">, </span><span class="hl-4">reject</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">access</span><span class="hl-1">(</span><span class="hl-4">urlPath</span><span class="hl-1">)</span><br/><span class="hl-1">        .</span><span class="hl-6">then</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-6">reject</span><span class="hl-1">(</span><span class="hl-8">&quot;La carta ya existe en la colección&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        })</span><br/><span class="hl-1">        .</span><span class="hl-6">catch</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-6">writeFile</span><span class="hl-1">(</span><span class="hl-4">urlPath</span><span class="hl-1">, </span><span class="hl-4">toWrite</span><span class="hl-1">, { </span><span class="hl-4">flag:</span><span class="hl-1"> </span><span class="hl-8">&quot;w&quot;</span><span class="hl-1"> })</span><br/><span class="hl-1">            .</span><span class="hl-6">then</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-6">resolve</span><span class="hl-1">(</span><br/><span class="hl-1">                </span><span class="hl-8">`La carta se ha añadido a la colección de </span><span class="hl-2">${</span><span class="hl-2">this</span><span class="hl-10">.</span><span class="hl-4">Cards</span><span class="hl-10">.</span><span class="hl-6">getUser</span><span class="hl-10">()</span><span class="hl-2">}</span><span class="hl-8">`</span><span class="hl-1">,</span><br/><span class="hl-1">              );</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">            .</span><span class="hl-6">catch</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-6">reject</span><span class="hl-1">(</span><span class="hl-8">&quot;Error en el servidor&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">            });</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Vemos como ahora, la función devuelve una promesa de tipo <code>string</code>, dentro de la propia función, se usa los métodos del filesystem basados en promesas, obteniendo si se tuvo éxito o no mediante los métodos <code>then</code> y <code>catch</code>, y finalmente, dependiendo del flujo de la función, se llama a <code>resolve</code> si se tiene éxito y a <code>reject</code> si se incumplió la promesa.</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-4">CardCollection</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-8">&quot;../CardCollection.js&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-4">rm</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-8">&quot;node:fs/promises&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">/**</span><br/><span class="hl-5"> * Represents an operation to delete a card from a collection.</span><br/><span class="hl-5"> */</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">DeleteCard</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">/**</span><br/><span class="hl-5">   * Creates an instance of DeleteCard.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">Cards</span><span class="hl-5"> The collection of cards from which the card will be deleted.</span><br/><span class="hl-5">   */</span><br/><span class="hl-1">  </span><span class="hl-2">constructor</span><span class="hl-1">(</span><span class="hl-2">private</span><span class="hl-1"> </span><span class="hl-4">Cards</span><span class="hl-1">: </span><span class="hl-3">CardCollection</span><span class="hl-1">) {}</span><br/><span class="hl-1">  </span><span class="hl-5">/**</span><br/><span class="hl-5">   * Deletes a card from the collection based on its id.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">toDeleteId</span><span class="hl-5"> The id of the card to be deleted.</span><br/><span class="hl-5">   * </span><span class="hl-2">@param</span><span class="hl-5"> </span><span class="hl-4">callback</span><span class="hl-5"> A function to be called when finished.</span><br/><span class="hl-5">   */</span><br/><span class="hl-1">  </span><span class="hl-6">delete</span><span class="hl-1">(</span><span class="hl-4">toDeleteId</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">): </span><span class="hl-3">Promise</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-7">found</span><span class="hl-1"> = </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-4">Cards</span><span class="hl-1">.</span><span class="hl-4">collection</span><span class="hl-1">.</span><span class="hl-6">find</span><span class="hl-1">((</span><span class="hl-4">card</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">card</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> === </span><span class="hl-4">toDeleteId</span><span class="hl-1">;</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Promise</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt;((</span><span class="hl-4">resolve</span><span class="hl-1">, </span><span class="hl-4">reject</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">found</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">rm</span><span class="hl-1">(</span><span class="hl-8">`</span><span class="hl-2">${</span><span class="hl-2">this</span><span class="hl-10">.</span><span class="hl-4">Cards</span><span class="hl-10">.</span><span class="hl-6">getUser</span><span class="hl-10">()</span><span class="hl-2">}</span><span class="hl-8">/</span><span class="hl-2">${</span><span class="hl-4">found</span><span class="hl-10">.</span><span class="hl-4">name</span><span class="hl-2">}</span><span class="hl-8">.json`</span><span class="hl-1">)</span><br/><span class="hl-1">          .</span><span class="hl-6">then</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-6">resolve</span><span class="hl-1">(</span><br/><span class="hl-1">              </span><span class="hl-8">`La carta </span><span class="hl-2">${</span><span class="hl-4">toDeleteId</span><span class="hl-2">}</span><span class="hl-8"> ha sido eliminada de la colección de </span><span class="hl-2">${</span><span class="hl-2">this</span><span class="hl-10">.</span><span class="hl-4">Cards</span><span class="hl-10">.</span><span class="hl-6">getUser</span><span class="hl-10">()</span><span class="hl-2">}</span><span class="hl-8">`</span><span class="hl-1">,</span><br/><span class="hl-1">            );</span><br/><span class="hl-1">          })</span><br/><span class="hl-1">          .</span><span class="hl-6">catch</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-6">reject</span><span class="hl-1">(</span><span class="hl-8">`Error al eliminar`</span><span class="hl-1">);</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">      } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-6">reject</span><span class="hl-1">(</span><span class="hl-8">&quot;La carta no fue encontrada&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:conclusiones" class="tsd-anchor"></a><h2><a href="#md:conclusiones">Conclusiones:</a></h2><p>La realización de la práctica proporcionó un conocimiento más profundo acerca de la creación de aplicaciones express. Así como la consolidación de conceptos del lenguaje como Objetos, Clases, interfaces, principios SOLID y sus aplicaciones,sobre patrones de diseño y gestión del sistema de archivos. Además de seguir mejorando la lógica de programación, no solamente aplicada a TypeScript si no a cualquier lenguaje y a continuar prosperando con elementos como el desarrollo basado en pruebas, la generación de documentación automática y el cubrimiento de código.</p>
<a id="md:bibliografía" class="tsd-anchor"></a><h2><a href="#md:bibliografía">Bibliografía</a></h2><ul>
<li><a href="https://developer.mozilla.org/es/docs/Web/JavaScript/Guide/Working_with_objects">Documentación sobre objetos de Mozzilla</a>.</li>
<li><a href="https://developer.mozilla.org/es/docs/Web/JavaScript/Reference/Classes">Documentación sobre clases de Mozzilla</a></li>
<li><a href="https://developer.mozilla.org/es/docs/Web/JavaScript">Documentación de JavaScript de Mozzilla</a>.</li>
<li><a href="https://mochajs.org/">Documentación de Mocha</a>.</li>
<li><a href="https://www.chaijs.com/">Documentación de Chai</a>.</li>
<li><a href="https://typedoc.org/">Documentación de TypeDoc</a>.</li>
<li><a href="https://nodejs.org/docs/latest/api/">Documentación de Node</a>.</li>
<li><a href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&cad=rja&uact=8&ved=2ahUKEwj3tsPGj9OEAxWVT6QEHcycA4AQFnoECAcQAQ&url=https%3A%2F%2Fcoveralls.io%2F&usg=AOvVaw2PjKrDGWUgtP9bnQyMWMrr&opi=89978449">Web de Coveralls</a>.</li>
<li><a href="https://sonarcloud.io/">Web de SonarCloud</a>.</li>
<li><a href="https://expressjs.com/es/">Documentación de Express</a>.</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><ul><li><ul><li><a href="#md:informe-httpsull-esit-inf-dsi-2324githubioull-esit-inf-dsi-23-24-prct11-http-express-magic-app-gdiazbricio"><span>INFORME: https://ull-<wbr/>esit-<wbr/>inf-<wbr/>dsi-<wbr/>2324.github.io/ull-<wbr/>esit-<wbr/>inf-<wbr/>dsi-<wbr/>23-<wbr/>24-<wbr/>prct11-<wbr/>http-<wbr/>express-<wbr/>magic-<wbr/>app-<wbr/>gdiazbricio/</span></a></li></ul></li></ul><a href="#md:práctica-11-diseño-de-una-aplicación-express-servidor-para-la-gestión-de-cartas-magic"><span>PRÁCTICA 11: DISEÑ<wbr/>O DE UNA APLICACIÓ<wbr/>N EXPRESS SERVIDOR PARA LA GESTIÓ<wbr/>N DE CARTAS MAGIC.</span></a><ul><li><ul><li><a href="#md:guillermo-díaz-bricio---desarrollo-de-sistemas-informáticos-3º-grado-en-ingeniería-informática"><span>Guillermo <wbr/>Díaz <wbr/>Bricio -<wbr/> <wbr/>Desarrollo de <wbr/>Sistemas <wbr/>Informáticos, 3º <wbr/>Grado en <wbr/>Ingeniería <wbr/>Informática</span></a></li></ul></li><li><a href="#md:contenidos"><span>Contenidos:</span></a></li><li><a href="#md:resumen"><span>Resumen:</span></a></li><li><a href="#md:objetivos"><span>Objetivos:</span></a></li><li><a href="#md:ejercicio-propuesto-en-el-guión"><span>Ejercicio propuesto en el guión:</span></a></li><li><a href="#md:ejercicios-propuestos-en-el-aula"><span>Ejercicios propuestos en el aula:</span></a></li><li><a href="#md:conclusiones"><span>Conclusiones:</span></a></li><li><a href="#md:bibliografía"><span>Bibliografía</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>doc-test</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>